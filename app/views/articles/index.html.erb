<%- model_class = Article.new.class -%>
<h1><%=t '.title', :default => model_class.model_name.human %></h1>

<% @articles.each do |article| %>
    <div class="article well">
        <h2><%= link_to article.title, article_path(article) %></h2>

        <nobr>
            <%= colored_name(article.user) %>  <%=l article.created_at, format: :short %>
        </nobr>

        <%= auto_link(article.content.html_safe) %>

        <div class="buttons">
          <% if current_user.is_admin? || article.user == current_user %>
            <%= link_to edit_article_path(article), :class => 'btn btn-mini' do %>
              <i class="icon icon-pencil"></i>
            <% end %>

            <%= link_to article_path(article),
                      :method => :delete,
                      :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')),
                      :class => 'btn btn-mini btn-danger' do %>
              <i class="icon icon-trash"></i>
            <% end %>
          <% end %>
        </div>

        <div class="comments">
          <a href="#" onclick="return commentToggle(this);">
            <span class="icon-chevron-right">&nbsp;</span>
            <%= article.comments.length %>
            <%=t 'comments.plural' %>
          </a>

          <div class="commentContainer">
            <table>
              <% article.comments.each do |comment| %>
                <tr>
                  <th>
                    <%= colored_name(comment.user) %>:
                  </th>
                  <td>
                    <div class="commentButtons">
                      <% if current_user.is_admin? || comment.user == current_user %>
                        <%= link_to article_comment_path(article, comment),
                                  :method => :delete,
                                  :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) do %>
                          <i class="icon icon-remove"></i>
                        <% end %>

                         <a href="#" onClick="return editComment('<%= comment.id %>')">
                            <i class="icon icon-edit"></i>
                        </a>

                      <% end %>
                    </div>

                   <div class="comment" id="comment<%= comment.id %>" onClick="return editComment('<%= comment.id %>')" align="left">
                    <%= auto_link(comment.content.html_safe) %>
                  </div>

                  <div class="comment-edit" id="comment<%= comment.id %>edit" style="display:none;">
                    <%= form_for([article, comment]) do |f| %>
                    <div class="input-append">
                      <%= f.text_field :content, :class => "span6" %><%= f.submit "Save", :class => 'btn' %>
                    </div>
                  <% end %>
                </div>

                  </td>
                </tr>
              <% end %>
            </table>

            <br />

            <%= form_for([article, article.comments.build]) do |f| %>
              <div class="input-append">
                <%= f.text_field :content, :class => "span7" %><%= f.submit "Save", :class => 'btn' %>
              </div>
            <% end %>
          </div>
        </div>
    </div>
<% end %>

<%= will_paginate @articles %>