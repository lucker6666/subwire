<!DOCTYPE html>
<html>
	<head>
		<title>
			<% if @unread_notification_count > 0 %>
				(<%= @unread_notification_count %>)
			<% end %>

			<%= @subwireTitle %>
		</title>

		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript">
			</script>
		<![endif]-->

		<script type="text/javascript">
			window.pollNotifications = true;
		</script>

		<%= stylesheet_link_tag    "application", :media => "all" %>
		<%= javascript_include_tag "application" %>
		<%= csrf_meta_tags %>

		<script type="text/javascript">
			<% if current_instance %>
				window.subwireTitle = "<%= current_instance.name %>";
				<% else %>
					window.subwireTitle = "<%= @subwireTitle %>";
			<% end %>
		</script>

		<% unless display_ads %>
			<style type="text/css">
				.advertising { display: none; }
			</style>
		<% end %>


		<link rel="shortcut icon" href="/assets/favicon.png" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	</head>

	<body>
		<div class="navbar navbar-fixed-top navbar-inverse">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>

					<ul class="nav">
						<li>
							<%= link_to current_instance.name, articles_path, :class => "brand" %>
						</li>
					</ul>

					<div class="nav-collapse">
						<ul class="nav">
							<li class="dropdown iconOnly">
								<% if instances.length > 0 %>
									<a href="#" class="dropdown-toggle" data-toggle="dropdown"
										rel="tooltip" title="<%=t 'tooltip.instanceSwitcher' %>"
										data-placement="bottom">

										<i class="icon-home"></i>
									</a>

									<ul class="instances-dropdown dropdown-menu">
										<% instances.each do |instance| %>
											<% notificationCount = instance.notification_count(current_user) %>
											<li>
												<%=
													link_to instance_path(instance), {
														:class =>
														(instance == current_instance ? "active" : "")
													} do
												%>
													<% if notificationCount > 0 %>
														<span class="notification-badge badge badge-info">
															<%= notificationCount %>
														</span>

														&nbsp;
													<% end %>

													<%= instance.name %>
												<% end %>
											</li>
										<% end %>

										<li>
											<%= link_to t("instances.overview"), "/instances/unset" %>
										</li>
									</ul>
								<% end %>
							</li>

							<%= render :partial => 'shared/notifications' %>

							<% if has_admin_privileges? %>
								<li class="dropdown iconOnly">
									<a href="#" class="dropdown-toggle" data-toggle="dropdown"
										rel="tooltip" title="<%=t 'tooltip.instanceSettings' %>"
										data-placement="bottom">
										<i class="icon-cog"></i>
									</a>

									<ul class="instances-dropdown dropdown-menu">
										<li>
											<%= link_to relationships_path do %>
												<i class="icon icon-user"></i>
												<%= t "application.user_management" %>
											<% end %>
										</li>

										<li>
											<%= link_to links_path do %>
												<i class="icon icon-screenshot"></i>
												<%= t "application.link_management" %>
											<% end %>
										</li>

										<li>
											<%= link_to edit_instance_path(current_instance) do %>
												<i class="icon icon-cog"></i>
												<%= t "instances.edit" %>
											<% end %>
										</li>
									</ul>
								</li>
							<% end %>
						</ul>

						<ul class="nav">
							<li class="divider-vertical"></li>

							<li>
								<%= link_to new_article_path do %>
									<i class="icon icon-file"></i>
									<%= t "application.new_article" %>
								<% end %>
							</li>

							<% if has_superadmin_privileges? %>
								<li class="dropdown">
									<a href="#" class="dropdown-toggle" data-toggle="dropdown">
										<i class="icon icon-fire"></i>
										Admin
										<b class="caret"></b>
									</a>

									<ul class="admin-dropdown dropdown-menu">
										<li>
											<%= link_to users_path do %>
												<i class="icon icon-user"></i>
												<%= t('application.all_users') %>
											<% end %>
										</li>

										<li>
											<%= link_to "/instances/all" do %>
												<i class="icon icon-list-alt"></i>
												<%= t('application.all_instances') %>
											<% end %>
										</li>
									</ul>
								</li>
							<% end %>
						</ul>

						<% if current_instance.planningTool %>
							<ul class="nav pull-right availabilitites">
								<li class="divider-vertical"></li>
								<li class="dropdown planner">
								    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
								    	<i class="icon icon-calendar"></i>
										<%=l Date.today, format: :long %>

										<%
											availabilities = Availability.where(
												"date >= ? and user_id = ?", Date.today, current_user.id
											)

											if availabilities.length < 7
										%>
											<span class="badge badge-warning">!</span>
										<% end %>

								        <b class="caret"></b>
								    </a>

								    <div class="dropdown-menu">
								    	<%= render :partial => 'shared/availability' %>
								    </div>
								</li>
							</ul>
						<% end %>

						<ul class="nav pull-right">
							<li class="divider-vertical"></li>

							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
									<%= avatar current_user, :tiny, 'current-user' %>
									<%= current_user.name %>
									<b class="caret"></b>
								</a>

								<ul class="admin-dropdown dropdown-menu">
									<li>
										<%= link_to user_path(current_user) do %>
											<i class="icon icon-user"></i>
											<%= t "application.your_profile" %>
										<% end %>
									</li>

									<li>
										<%= link_to edit_user_path(current_user) do %>
											<i class="icon icon-cog"></i>
											<%= t "application.edit_your_profile" %>
										<% end %>
									</li>

									<li>
										<%= link_to destroy_user_session_path do %>
											<i class="icon icon-remove"></i>
											<%= t "application.logout" %>
										<% end %>
									</li>
								</ul>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>

		<div class="container content">
			<div class="row">
				<div class="span9">
					<%= yield %>
				</div>

				<div class="span3 sidebar">
					<% if @sidebar_links.length > 0 %>
						<div class="well">
							<h3>
								<i class="icon icon-heart"></i>
								<%= t "application.bookmarks" %>
							</h3>

							<ul class="bookmarks nav nav-list">
								<% @sidebar_links.each do |link| %>
									<li>
										<a href="<%= link.href %>" target="_blank">
											<% if !link.icon.empty? %>
												<i class="icon icon-<%= link.icon %>"></i>
											<% end %>

											<%= link.name %>
										</a>
									</li>
								<% end %>
							</ul>
						</div>
					<% end %>

					<div class="well">
						<h3>
							<i class="icon icon-user"></i>
							<%= t "application.user" %>
						</h3>

						<ul class="users nav nav-list">
							<% @sidebar_users.each do |user| %>
								<li>
									<%= avatar(user, :list) %>
    
                                    <%= link_to user_path(user) do %>
                                    	<i class="icon icon-asterisk" style="color:<%= user.login_status(current_user.name) %>"></i>
                                    	<%= user.name %>
									<% end %>
								</li>
							<% end %>
						</ul>
					</div>

					<div class="advertising">
						<div class="well">
							<div style="width: 200px; margin: 0 auto;">
								<%= t('ad') %>

								<script type="text/javascript"><!--
								google_ad_client = "ca-pub-4129785061498511";
								/* Subwire Sidebar */
								google_ad_slot = "4641294977";
								google_ad_width = 200;
								google_ad_height = 200;
								//-->
								</script>
								<script type="text/javascript"
								src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
								</script>
							</div>
						</div>
					</div>
				</div>
			</div>

			<%= render :partial => 'shared/footer' %>
		</div>

		<%= render :partial => 'shared/flash_messages' %>
		<%= render :partial => 'shared/ga' %>
	</body>
</html>
