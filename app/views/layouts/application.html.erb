<!DOCTYPE html>
<html>
	<head>
		<title>
			BrainDump

			<% if notifications.length > 0 %>
				(<%= notifications.length %>)
			<% end %>
		</title>

		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript">
			</script>
		<![endif]-->

		<%= stylesheet_link_tag    "application", :media => "all" %>
		<%= javascript_include_tag "application" %>
		<%= csrf_meta_tags %>

		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	</head>

	<body>
		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<%= link_to current_instance.name, articles_path, :class => "brand" %>

					<div class="nav-collapse">
						<ul class="nav">
							<li class="dropdown">
							    <% if notifications.length > 0 %>
								    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
								    	<i class="icon icon-exclamation-sign"></i>
								    	<%= t "application.notifications" %>

								    	<span class="notification-badge badge badge-info">
								    		<%= notifications.length %>
								    	</span>
								        <b class="caret"></b>
								    </a>

								    <ul class="notification-dropdown dropdown-menu">
								    	<% notifications.each do |notification| %>
									    	<li>
									    		<a href="<%= notification_path(notification) %>">
									    			<%= notification_icon(notification) %>
									    			<%= notification.message.html_safe %>
									    		</a>
									    	</li>
									    <% end %>
								    </ul>
								<% else %>
									<a href="#" class="dropdown-toggle" data-toggle="dropdown">
								    	<i class="icon icon-exclamation-sign"></i>
								    	<%= t "application.notifications" %>

								    	<span class="notification-badge">
								    	</span>
								        <b class="caret"></b>
								    </a>

									<ul class="dropdown-menu">
										<li><%= t "application.notifications_unread" %></li>
									</ul>
							    <% end %>
							</li>

							<li>
								<%= link_to new_article_path do %>
							    	<i class="icon icon-file"></i>
							    	<%= t "application.new_article" %>
								<% end %>
							</li>

							<% if current_user.is_admin %>
								<li>
									<%= link_to users_path do %>
							    		<i class="icon icon-user"></i>
										<%= t "application.user_management" %>
									<% end %>
								</li>

								<li>
									<%= link_to links_path do %>
							    		<i class="icon icon-screenshot"></i>
										<%= t "application.link_management" %>
									<% end %>
								</li>
							<% else %>
								<li>
									<%= link_to edit_user_path(current_user) do %>
							    		<i class="icon icon-user"></i>
										<%= t "application.your_profile" %>
									<% end %>
								</li>
							<% end %>
							<li>
								<% if I18n.locale == :en %>
									<%= link_to locale_path("de") do %>
										<i class="icon icon-flag"></i>
										<%= t "application.german" %>
									<% end %>
								<% else %>
									<%= link_to locale_path("en") do %>
										<i class="icon icon-flag"></i>
										<%= t "application.english" %>
									<% end %>
								<% end %>

							</li>
							<li>
								<%= link_to destroy_user_session_path, :method => :delete do %>
							    	<i class="icon icon-remove"></i>
									<%= t "application.logout" %>
								<% end %>
							</li>

						</ul>

						<ul class="nav pull-right">
							<li class="divider-vertical"></li>
							<li class="dropdown">
							    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
							    	<i class="icon icon-calendar"></i>
									<%=l Date.today, format: :long %>

									<%
										availabilities = Availability.where(
											"date >= ? and user_id = ?", Date.today, current_user.id
										)

										if availabilities.length < 7
									%>
										<span class="badge badge-warning">!</span>
									<% end %>

							        <b class="caret"></b>
							    </a>

							    <div class="dropdown-menu">
							    	<%= render :partial => 'shared/availability' %>
							    </div>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>

		<div class="container content">
			<div class="row">
				<div class="span9">
					<%= yield %>
				</div>

				<div class="span3 sidebar">
					<div class="well">
						<h2><%= t "application.bookmarks" %></h2>

						<ul class="bookmarks nav nav-list">
							<% Link.all.each do |link| %>
								<li>
									<a href="<%= link.href %>" target="_blank">
										<% if !link.icon.empty? %>
											<i class="icon icon-<%= link.icon %>"></i>
										<% end %>

										<%= link.name %>
									</a>
								</li>
							<% end %>
						</ul>
					</div>

					<div class="well">
						<h2><%= t "application.user" %></h2>

						<ul class="users nav nav-list">
							<% User.all.each do |user| %>
								<li>
									<%= link_to user.name, user_path(user) %>
								</li>
							<% end %>
						</ul>
					</div>
				</div>
			</div>

			<%= render :partial => 'shared/footer' %>
		</div>

		<%= render :partial => 'shared/flash_messages' %>
	</body>
</html>
